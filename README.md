# ğŸŒ OpenTelemetry ê¸°ë°˜ ë¶„ì‚° íŠ¸ë ˆì´ì‹± ë°ëª¨ í”„ë¡œì íŠ¸

## ğŸ§  í”„ë¡œì íŠ¸ ì†Œê°œ

ì´ í”„ë¡œì íŠ¸ëŠ” **OpenTelemetry**ë¥¼ í™œìš©í•œ ë¶„ì‚° ì¶”ì  ì‹œìŠ¤í…œì„ ì§ì ‘ êµ¬ì„±í•˜ê³ ,  
**ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ ìš”ì²­ íë¦„ì„ ì‹œê°ì ìœ¼ë¡œ ì¶”ì **í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•œ ë°ëª¨ì…ë‹ˆë‹¤.  
ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œ ì¥ì•  ì¶”ì , ë³‘ëª© íƒì§€, íë¦„ íŒŒì•…ì„ ì–¼ë§ˆë‚˜ ì‰½ê²Œ í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì‹œê°í™”í•˜ì—¬ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ êµ¬ì„±

- **Spring Boot ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ 2ê°œ**
  - `order-service`: ì£¼ë¬¸ ìš”ì²­ ì²˜ë¦¬ ë° ê²°ì œ í˜¸ì¶œ
  - `payment-service`: ê²°ì œ ì‘ë‹µ ì²˜ë¦¬ (ì‘ë‹µ ì§€ì—° ì‹œë®¬ë ˆì´ì…˜ í¬í•¨)
- **PostgreSQL**: ì¬ê³  ë° ì£¼ë¬¸ ì €ì¥ìš© DB
- **OpenTelemetry Collector**: ë°ì´í„° ìˆ˜ì§‘ ë° ì²˜ë¦¬
- **Tempo (Grafana)**: íŠ¸ë ˆì´ìŠ¤ ì €ì¥ì†Œ
- **Grafana**: íŠ¸ë ˆì´ìŠ¤ ì‹œê°í™” ë„êµ¬


---

## ğŸ” ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ

| ê¸°ìˆ                          | ì„¤ëª…                                       |
|------------------------------|--------------------------------------------|
| Spring Boot                  | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜                |
| PostgreSQL                   | ì£¼ë¬¸/ì¬ê³  ë°ì´í„° ì €ì¥                      |
| Docker                       | Grafana, Tempo, Collector ì»¨í…Œì´ë„ˆ êµ¬ì„±   |
| OpenTelemetry SDK            | íŠ¸ë ˆì´ìŠ¤ ìƒì„± ë° ì „íŒŒ                      |
| Java Agent                   | ìë™ ìŠ¤íŒ¬ ìƒì„±                            |
| Grafana Explore              | íŠ¸ë ˆì´ìŠ¤ ì‹œê°í™” ë„êµ¬                       |
| Tempo                        | ë¶„ì‚° íŠ¸ë ˆì´ìŠ¤ ì €ì¥ì†Œ (Grafana ì—°ë™ ìµœì í™”) |

---

## ğŸ¯ ì‹¤ìŠµ ëª©í‘œ

1. **ë¶„ì‚° íŠ¸ë ˆì´ì‹±ì˜ í•„ìš”ì„± ì²´ê°**
2. **OpenTelemetryì˜ êµ¬ì¡° ë° ë™ì‘ íë¦„ ì´í•´**
3. **Collector - Exporter - Backend ì—°ë™ ì‹¤ìŠµ**
4. **ì‹¤ì œ ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ íŠ¸ë ˆì´ì‹± ë° ì‹œê°í™”**

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

| í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤          | í˜¸ì¶œ ì˜ˆì‹œ                                              | ê¸°ëŒ€ ê²°ê³¼                   |
|------------------------|--------------------------------------------------------|-----------------------------|
| âœ… ì •ìƒ ì£¼ë¬¸           | `GET /order?productName=Book&delay=100`               | ì£¼ë¬¸ ì„±ê³µ                   |
| âŒ ì¬ê³  ì—†ìŒ           | `GET /order?productName=OutOfStockItem&delay=100`     | ì£¼ë¬¸ ì‹¤íŒ¨ (ì¬ê³  ì—†ìŒ)      |
| âŒ ê²°ì œ ì§€ì—° (íƒ€ì„ì•„ì›ƒ) | `GET /order?productName=Book&delay=600`               | ì£¼ë¬¸ ì‹¤íŒ¨ (ê²°ì œ ì§€ì—° ì´ˆê³¼) |

> í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” Grafana â†’ Explore ë©”ë‰´ì—ì„œ í™•ì¸ ê°€ëŠ¥í•˜ë©°, ê° ìŠ¤íŒ¬ì— ëŒ€í•œ ì§€ì—° ì‹œê°„ ë° ì—ëŸ¬ ìƒíƒœ í™•ì¸ ê°€ëŠ¥

---

## ğŸ“¸ íŠ¸ë ˆì´ì‹± êµ¬ì¡°

- ë£¨íŠ¸ ìŠ¤íŒ¬: `/order`  
- ìì‹ ìŠ¤íŒ¬ë“¤:
  - `check-stock`
  - `call-payment-api`
  - `save-order`

ì—ëŸ¬ ë°œìƒ ì‹œ í•´ë‹¹ ìì‹ ìŠ¤íŒ¬ì— `Status: ERROR` ì™€ í•¨ê»˜ ì˜ˆì™¸ ë©”ì‹œì§€ê°€ ì‹œê°í™”ë¨

---

## ğŸ”§ ì£¼ìš” ì„¤ì • ìš”ì•½

### application.yml

```yaml
otel:
  exporter:
    otlp:
      endpoint: http://localhost:4317
  service:
    name: order-service
management:
  endpoints:
    web:
      exposure:
        include: "*"
```
### docker-compose.yml

```yaml
services:
  collector:
    image: otel/opentelemetry-collector-contrib:latest
    ports:
      - "4317:4317"
  tempo:
    image: grafana/tempo:latest
    ports:
      - "3200:3200"
  grafana:
    image: grafana/grafana-oss:latest
    ports:
      - "3000:3000"
  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: demo_db
      POSTGRES_USER: demo
      POSTGRES_PASSWORD: demo123
    ports:
      - "5432:5432"
```

## ê²°ë¡ 
ë‹¨ì¼ ë¡œê·¸ë§Œìœ¼ë¡œëŠ” ì¶”ì ì´ ì–´ë ¤ìš´ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°ì—ì„œ
OpenTelemetry ê¸°ë°˜ ë¶„ì‚° íŠ¸ë ˆì´ì‹±ì€ ìš”ì²­ íë¦„ì„ ì •í™•íˆ íŒŒì•…í•˜ê³  ì¥ì• ë¥¼ ë¹ ë¥´ê²Œ ì§„ë‹¨í•˜ëŠ” ë° í° í˜ì´ ë©ë‹ˆë‹¤.

ì´ ë°ëª¨ë¥¼ í†µí•´ ê·¸ë¼íŒŒë‚˜ì—ì„œ ì‹¤ì‹œê°„ íŠ¸ë ˆì´ìŠ¤ íë¦„ì„ ì‹œê°í™”í•˜ë©°
íŠ¸ë ˆì´ì‹± ë„êµ¬ëŠ” ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ì„ì„ ë‹¤ì‹œ í•œë²ˆ ëŠê¼ˆìŠµë‹ˆë‹¤.